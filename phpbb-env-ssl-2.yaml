apiVersion: '2021-10-01'
location: westus
name: phpbb_container
identity: 
  type: UserAssigned
  userAssignedIdentities: {
    '/subscriptions/570a1e43-d63b-4dee-8549-4dfecb870e90/resourcegroups/towang-forum/providers/Microsoft.ManagedIdentity/userAssignedIdentities/phpbb_id': {}
    }
properties:
  osType: Linux
  imageRegistryCredentials:
  - server: phpbb.azurecr.io
    identity: '/subscriptions/570a1e43-d63b-4dee-8549-4dfecb870e90/resourcegroups/towang-forum/providers/Microsoft.ManagedIdentity/userAssignedIdentities/phpbb_id'
  restartPolicy: OnFailure
  containers:
    - name: reverse-proxy
      properties:
        image: phpbb.azurecr.io/caddy:2.7
        ports:
          - protocol: TCP
            port: 80
          - protocol: TCP
            port: 443
        resources:
          requests:
            memoryInGB: 1.0
            cpu: 0.5
          limits:
            memoryInGB: 1.0
            cpu: 0.5
        volumeMounts:
          - name: proxy-caddyfile
            mountPath: /etc/caddy
          - name: proxy-data
            mountPath: /data
          - name: proxy-config
            mountPath: /config
    - name: phpbb
      properties:
        environmentVariables:
          - name: 'PHPBB_DB_DRIVER'
            value: 'mysqli'
          - name: 'PHPBB_DB_HOST'
            value: 'towang-mysql.mysql.database.azure.com'
          - name: 'PHPBB_DB_PORT'
            value: '3306'
          - name: 'PHPBB_DB_NAME'
            value: 'phpbb'
          - name: 'PHPBB_DB_USER'
            value: 'towang'
          - name: 'PHPBB_DB_PASSWD'
            secureValue: '...'
        image: phpbb.azurecr.io/wonglae/phpbb:latest
        ports:
          - protocol: TCP
            port: 8080
        resources:
          requests:
            cpu: 0.5
            memoryInGB: 2
        volumeMounts:
          - mountPath: /phpbb/www/aci/phpbb-upload/
            name: fileuploadvolume
          - mountPath: /phpbb/www/aci/phpbb-storage/
            name: filesharevolume
  ipAddress:
    type: Public
    ports:
      - protocol: TCP
        port: 80
      - protocol: TCP
        port: 443
    dnsNameLabel: wowang-net
  volumes:
    - name: proxy-caddyfile
      azureFile: 
        shareName: proxy-caddyfile
        storageAccountName: towangdatawestus
        storageAccountKey: ...
    - name: proxy-data
      azureFile: 
        shareName: proxy-data
        storageAccountName: towangdatawestus
        storageAccountKey: ...
    - name: proxy-config
      azureFile: 
        shareName: proxy-config
        storageAccountName: towangdatawestus
        storageAccountKey: ...
    - name: filesharevolume
      azureFile:
        sharename: phpbb-storage
        storageAccountName: towangdatawestus
        storageAccountKey: ...
    - name: fileuploadvolume
      azureFile:
        sharename: phpbb-upload
        storageAccountName: towangdatawestus
        storageAccountKey: ...
tags: null
type: Microsoft.ContainerInstance/containerGroups